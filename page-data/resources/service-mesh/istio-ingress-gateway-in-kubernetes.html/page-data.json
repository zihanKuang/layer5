{"componentChunkName":"component---src-templates-resource-single-js","path":"/resources/service-mesh/istio-ingress-gateway-in-kubernetes.html","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (-1 !== e.indexOf(n)) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Istio Ingress Gateway in Kubernetes\",\n  \"thumbnail\": \"./Istio Ingress Gateway.webp\",\n  \"darkthumbnail\": \"./Istio Ingress Gateway.webp\",\n  \"date\": \"2022-04-01 10:30:05 -0530\",\n  \"category\": \"Service Mesh\",\n  \"tags\": [\"Gateway\"],\n  \"type\": \"Article\",\n  \"product\": \"Meshery\",\n  \"technology\": \"Kubernetes\",\n  \"mesh\": \"Istio\",\n  \"featured\": false,\n  \"published\": true,\n  \"resource\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(ResourcesWrapper, {\n    mdxType: \"ResourcesWrapper\"\n  }, mdx(\"p\", null, \"Predominantly, Kubernetes has used an Ingress controller to handle the traffic that enters the cluster from the outside. Istio has replaced all the familiar Ingress resource with new Gateway and VirtualServices resources. They work in sync to route all the traffic into the mesh. Inside the mesh there is no requirement for Gateways since the services can access each other by a cluster local service name.\"), mdx(\"h3\", null, \"Let\\u2019s understand the working with a representation\"), mdx(\"p\", null, mdx(\"img\", {\n    src: Rep,\n    align: \"center\",\n    alt: \"Istio Ingress Gateway in Kubernetes No Title\"\n  })), mdx(\"p\", null, mdx(\"ul\", null, mdx(\"li\", null, \"Firstly A request is made by a client on a specific port\"), mdx(\"li\", null, \"Then a load balancer on this port listens and forwards the request to one of the workers in theh cluster on same or a new port\"), mdx(\"li\", null, \"Inside the cluster the request is routed to the Istio Ingress Gateway which is listened on the port of the load balancer\"), mdx(\"li\", null, \"The Service forwards the requestto an Istio Ingress Gateway Pod which is managed by a deployment\"), mdx(\"li\", null, \"The Ingress Gateway Pod is configured by a Gateway and a VirtualService.\"), mdx(\"li\", null, \"The Gateway configures all the ports, protocol, and certificates.\"), mdx(\"li\", null, \"The Virtual Service configures all the routing information to find the correct Servicein it.\"), mdx(\"li\", null, \"The Istio Ingress Gateway Pod routes the request to the application Service.\"), mdx(\"li\", null, \"And lastly, the application Service routes the request to an application Pod which is managed by a deployment.\"))), mdx(\"ul\", null), mdx(\"h2\", null, \"Ingress Gateway Service\"), mdx(\"p\", null, \"The Ingress Gateway Service must listen to all the ports to be able to forward the traffic to the Ingress Gateway pods. Here we will be using routing to bring all the port numbers back to their initial state.\"), mdx(\"p\", null, \"Note that a Kubernetes Service is not a real service, but, since we are using type: \\\"NodePort\\\", all the request will be handled by the kube-proxy provided by Kubernetes and forwarded to a node with a current running pod. Once on the node, an IP-tables is configured a request will be forwarded to the appropriate pod.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# From the istio-ingressgateway service\\n  ports:\\n  - name: http2\\n    nodePort: 30000\\n    port: 80\\n    protocol: TCP\\n  - name: https\\n    nodePort: 30443\\n    port: 443\\n    protocol: TCP\\n  - name: mysql\\n    nodePort: 30306\\n    port: 3306\\n    protocol: TCP\\n\")), mdx(\"p\", null, \"If we inspect the service, we will see that it defines more ports than we have describe above. So these ports will be used for all the internal Istio communication.\"), mdx(\"h2\", null, \"Ingress Gateway Deployment\"), mdx(\"p\", null, \"It's a wrapper around the Envoy proxy and it is configured as the sidecars used inside the service mesh. When a Gateway or VirtualService gets changed, they are detected by the Istio Pilot controller and converts this information to an Envoy configuration and sends it to all the proxies, including the Envoy inside the IngressGateway.\"), mdx(\"p\", null, \"Since container ports are not supposed to be declared in Kubernetes pods, we don't have to declare the ports in the Ingress Gateway Deployment. If we look inside the deployment we can see that there are a number of ports that are already declared anyway. We have to take care about the Ingress Gateway Deployment in SSL certificates. To access the certificates inside the Gateway resources, make sure that we have mounted all the required certificates properly.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# Example represents volume mounts\\nvolumeMounts:\\n- mountPath: /etc/istio/ingressgateway-certs\\n  name: ingressgateway-certs\\n  readOnly: true\\n- mountPath: /etc/istio/ingressgateway-ca-certs\\n  name: ingressgateway-ca-certs\\n  readOnly: true\\n\\n# Example represents volumes\\nvolumes:\\n- name: ingressgateway-certs\\n  secret:\\n    defaultMode: 420\\n    optional: true\\n    secretName: istio-ingressgateway-certs\\n- name: ingressgateway-ca-certs\\n  secret:\\n    defaultMode: 420\\n    optional: true\\n    secretName: istio-ingressgateway-ca-certs\\n\")), mdx(\"h2\", null, \"The Gateway\"), mdx(\"p\", null, \"The Gateway resources are used to configure the ports for Envoy and also support for the Kubernetes Ingress. Since all the three ports are exposed with the servies, we need these ports to be handled by the Envoy. It can be handled by declaring one or more Gateways.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\napiVersion: networking.istio.io/v1alpha3\\nkind: Gateway\\nmetadata:\\n  name: default-gateway\\n  namespace: istio-system\\nspec:\\n  selector:\\n    istio: ingressgateway\\n  servers:\\n\\n  - hosts:\\n    - '*'\\n    port:\\n      name: http\\n      number: 80\\n      protocol: HTTP\\n\\n  - hosts:\\n    - '*'\\n    port:\\n      name: https\\n      number: 443\\n      protocol: HTTPS\\n    tls:\\n      mode: SIMPLE\\n      privateKey: /etc/istio/ingressgateway-certs/tls.key\\n      serverCertificate: /etc/istio/ingressgateway-certs/tls.crt\\n\\n  - hosts: # For all the TCP routing this fields will be ignored, but it will be matched\\n    - '*'  # with the VirtualService, We use * since it will match anything.\\n    port:\\n      name: mysql\\n      number: 3306\\n      protocol: TCP\\n\")), mdx(\"h2\", null, \"VirtualService\"), mdx(\"p\", null, \"The last interesting resource we have is the VirtualService, it used in concert with the Gateway to configure Envoy.\"), mdx(\"p\", null, \"A general configuration for an HTTP(s) service\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\napiVersion: networking.istio.io/v1alpha3\\nkind: VirtualService\\nmetadata:\\n  name: counter\\nspec:\\n  gateways:\\n  - default-gateway.istio-system.svc.cluster.local\\n  hosts:\\n  - counter.lab.example.com\\n  http:\\n  - match:\\n    - uri:\\n      prefix: /\\n    route:\\n    - destination:\\n        host: counter\\n        port:\\n          number: 80\\n\\n\")), mdx(\"h2\", null, \"Application Service and Deployment\"), mdx(\"p\", null, \"The request have now reached the application service and deployment. These are normal Kubernetes resources.\"), mdx(\"h2\", null, \"Extras:\"), mdx(\"h3\", null, \"Debugging Istio Gateway\"), mdx(\"p\", null, \"First we will use istioctl to check the configuration status of Istio Ingress Gateway:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# istioctl proxy-status istio-ingressgateway-5586f47659-r64lb.istio-system\\nClusters Match\\nListeners Match\\nRoutes Match\\n\\n\")), mdx(\"p\", null, \"If anything does not get synced with it, try restarting the ingress gateway pod once - it may be possible that it somehow an update got missed. If RDS looked good, we can check access logs of it.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n#kubectl get configmap istio -n istio-system -o yaml | grep \\\"accessLogFile: \\\"\\ndisable access log.\\\\naccessLogFile: \\\\\\\"/dev/stdout\\\\\\\"\\\\n\\\\n# If accessLogEncoding\\n\\n\")), mdx(\"p\", null, \"Once all the access logs are enabled, we can try torequest a few more times and check the logs on the Ingress Gateway:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# kubectl logs -n istio-system istio-ingressgateway-5586f47659-r64lb | grep -v deprecated\\n\\n\"))));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Istio Ingress Gateway in Kubernetes","subtitle":null,"date":"April 1st, 2022","author":null,"category":"Service Mesh","tags":["Gateway"],"description":null,"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRpIAAABXRUJQVlA4WAoAAAAQAAAAEwAACwAAQUxQSBEAAAABD9D/iAgIBJL2J98gov+ZHQBWUDggWgAAANADAJ0BKhQADAA+0VSjS6gkoyGwCAEAGglpAABSui9EcCMXxIZwAAD+9hPeHc9BJcicWg4Stt4P6RO2muLV0Jjky6cPrFHMbfr8+JsYVp9/uo+acFskxC8IAA=="},"images":{"fallback":{"src":"/static/eec5644b77e71f1ff68a36b674aea59c/98792/Istio%20Ingress%20Gateway.webp","srcSet":"/static/eec5644b77e71f1ff68a36b674aea59c/2de71/Istio%20Ingress%20Gateway.webp 125w,\n/static/eec5644b77e71f1ff68a36b674aea59c/1f902/Istio%20Ingress%20Gateway.webp 250w,\n/static/eec5644b77e71f1ff68a36b674aea59c/98792/Istio%20Ingress%20Gateway.webp 500w","sizes":"(min-width: 500px) 500px, 100vw"},"sources":[]},"width":500,"height":288}},"extension":"webp","publicURL":"/static/eec5644b77e71f1ff68a36b674aea59c/Istio Ingress Gateway.webp"}},"fields":{"slug":"/resources/service-mesh/istio-ingress-gateway-in-kubernetes"}}},"pageContext":{"slug":"/resources/service-mesh/istio-ingress-gateway-in-kubernetes"}},"staticQueryHashes":["1485533831","3750885592","4047814605","4053865456"],"slicesMap":{},"matchPath":"/resources/service-mesh/istio-ingress-gateway-in-kubernetes"}